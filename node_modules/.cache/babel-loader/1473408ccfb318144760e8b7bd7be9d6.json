{"ast":null,"code":"import _objectSpread from \"/Users/linjiajun/Desktop/htdoc/web/react-desktops/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/linjiajun/Desktop/htdoc/web/react-desktops/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/linjiajun/Desktop/htdoc/web/react-desktops/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/linjiajun/Desktop/htdoc/web/react-desktops/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/linjiajun/Desktop/htdoc/web/react-desktops/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/linjiajun/Desktop/htdoc/web/react-desktops/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/linjiajun/Desktop/htdoc/web/react-desktops/src/components/windows/WindowsMac.js\";\nimport React, { Component, Fragment } from 'react';\nimport { View, Window, TitleBar } from 'react-desktop';\nimport { connect } from 'react-redux';\nimport { actionCreators as actionCreatorsHomeMac } from '../../pages/Home/store';\nvar WindowOffsetWidth = window.innerWidth;\nvar WindowOffsetHeight = window.innerHeight;\nvar lastWindowStyleState = null; //记录前一次设置的屏幕属性\n\nvar WindowsMac =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(WindowsMac, _Component);\n\n  function WindowsMac(props) {\n    var _this;\n\n    _classCallCheck(this, WindowsMac);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(WindowsMac).call(this, props));\n    _this.state = {\n      isFullScreen: false\n    };\n\n    _this.setZIndex = function (zIndex) {\n      _this.setState({\n        zIndex: zIndex\n      });\n    };\n\n    _this.mouseMoveDown = function (e, type) {\n      if (!_this.state.isFullScreen) {\n        e.stopPropagation(); //防止事件冒泡\n\n        _this.windowWidth = _this.window.offsetWidth;\n        _this.windowHeight = _this.window.offsetHeight;\n        _this.moveStartX = e.clientX;\n        _this.moveStartY = e.clientY;\n        _this.moving = true;\n        _this.type = type;\n        window.addEventListener('mousemove', _this.mouseMove);\n        _this.windowCover.style.display = 'block';\n      }\n    };\n\n    _this.moveDivWeightHeight = function (e) {\n      e.preventDefault();\n\n      if (_this.moving) {\n        var moveEndX = e.clientX;\n        var moveEndY = e.clientY;\n        var width = _this.windowWidth + moveEndX - _this.moveStartX;\n        var height = _this.windowHeight + moveEndY - _this.moveStartY;\n\n        if (width > 460 && width < WindowOffsetWidth - 77) {\n          _this.window.style.width = width + 'px';\n        }\n\n        if (height > 400 && height < WindowOffsetHeight - 26) {\n          _this.window.style.height = height + 'px';\n        }\n      }\n    };\n\n    _this.handleClickSetScreen = function () {\n      var isFullScreen = _this.state.isFullScreen;\n\n      if (isFullScreen) {\n        _this.setState({\n          isFullScreen: false\n        }, function () {\n          _this.window.style.width = lastWindowStyleState.width;\n          _this.window.style.height = lastWindowStyleState.height;\n          _this.window.style.left = lastWindowStyleState.left;\n          _this.window.style.top = lastWindowStyleState.top;\n          _this.window.style.zIndex = lastWindowStyleState.zIndex;\n          lastWindowStyleState = null;\n        });\n      } else {\n        lastWindowStyleState = _objectSpread({}, _this.window.style);\n\n        _this.setState({\n          isFullScreen: true\n        }, function () {\n          _this.window.style.width = WindowOffsetWidth + 'px';\n          _this.window.style.height = WindowOffsetHeight + 'px';\n          _this.window.style.top = '0px';\n          _this.window.style.left = '0px';\n          _this.window.style.zIndex = '10';\n        });\n      }\n    };\n\n    _this.toggleWindowShow = function () {\n      _this.setState({\n        showWindow: !_this.state.showWindow\n      });\n    };\n\n    _this.mouseMovePosition = function (e) {\n      e.preventDefault();\n      var mouseEndX = e.clientX;\n      var mouseEndY = e.clientY;\n      _this.windowLeftEnd = _this.windowLeft + mouseEndX - _this.moveStartX;\n      _this.windowTopEnd = _this.windowTop + mouseEndY - _this.moveStartY;\n\n      if (_this.windowTopEnd < 26) {\n        //防止移动和工具栏重叠\n        _this.windowTopEnd = 26;\n      }\n\n      if (_this.windowTopEnd >= document.body.clientHeight - 26) {\n        _this.windowTopEnd = document.body.clientHeight - 26;\n      }\n\n      if (_this.windowLeftEnd < 80 - _this.windowWidth) {\n        _this.windowLeftEnd = 80 - _this.windowWidth;\n      }\n\n      if (_this.windowLeftEnd >= document.body.clientWidth - 80) {\n        _this.windowLeftEnd = document.body.clientWidth - 80;\n      }\n\n      _this.window.style.top = _this.windowTopEnd + 'px';\n      _this.window.style.left = _this.windowLeftEnd + 'px';\n    };\n\n    _this.mouseMove = function (e) {\n      e.preventDefault();\n\n      if (_this.moving) {\n        if (_this.type === 'position') {\n          _this.mouseMovePosition(e);\n        }\n\n        if (_this.type === 'wh') {\n          _this.moveDivWeightHeight(e);\n        }\n      }\n    };\n\n    _this.mouseUp = function () {\n      _this.moving = false;\n\n      if (_this.type === 'position') {\n        _this.windowLeft = _this.windowLeftEnd;\n        _this.windowTop = _this.windowTopEnd;\n        _this.windowCover.style.display = 'none';\n      }\n\n      if (_this.type === 'wh') {\n        _this.moveStartX = null;\n        _this.moveStartY = null;\n        _this.windowWidth = null;\n        _this.windowHeight = null;\n        _this.windowCover.style.display = 'none';\n      }\n\n      _this.type = '';\n      window.removeEventListener('mousemove', _this.mouseMove);\n    };\n\n    _this.moving = false;\n    _this.type = '';\n    _this.width = WindowOffsetWidth - 105 + 'px';\n    _this.height = WindowOffsetHeight - 50 + 'px';\n    _this.windowTop = 26;\n    _this.windowLeft = 80;\n    return _this;\n  }\n\n  _createClass(WindowsMac, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener('mouseup', this.mouseUp);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener('mouseup', this.mouseUp);\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(newProps, newState) {\n      if (newProps.zIndex !== this.props.zIndex) {\n        return true;\n      }\n\n      if (newProps.window !== this.props.window) {\n        return true;\n      }\n\n      if (newState.isFullScreen !== this.state.isFullScreen) {\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var isFullScreen = this.state.isFullScreen;\n      var showWindowStyleProperty = this.props.window.isShow ? \"visible\" : \"hidden\";\n      var windowStyle = {\n        position: 'absolute',\n        display: 'block',\n        top: this.windowTop + \"px\",\n        left: this.windowLeft + \"px\",\n        width: this.width,\n        height: this.height,\n        zIndex: this.props.zIndex,\n        visibility: showWindowStyleProperty\n      };\n      var buttonStyle = {\n        width: '50px',\n        height: '50px',\n        position: 'absolute',\n        bottom: '-15px',\n        right: '-15px',\n        cursor: 'se-resize',\n        zIndex: this.props.zIndex + 9\n      };\n      var showCover = this.props.window.isTop ? 'none' : 'block';\n      var cover = {\n        width: '100%',\n        height: '100%',\n        position: 'absolute',\n        zIndex: this.props.zIndex + 8,\n        display: showCover\n      };\n      return React.createElement(Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        style: windowStyle,\n        ref: function ref(e) {\n          return _this2.window = e;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }, React.createElement(Window, {\n        chrome: true,\n        width: \"100%\",\n        height: \"100%\",\n        padding: \"0px\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      }, React.createElement(TitleBar, {\n        title: this.props.window.name,\n        controls: true,\n        isFullscreen: isFullScreen,\n        onCloseClick: function onCloseClick() {\n          _this2.props.closeWindow(_this2.props.window.type, _this2.props.openWindowList);\n        },\n        onMinimizeClick: function onMinimizeClick() {\n          return _this2.props.hiddenWindow(_this2.props.window, _this2.props.openWindowList);\n        },\n        onResizeClick: function onResizeClick() {\n          _this2.handleClickSetScreen();\n        },\n        onMouseDown: function onMouseDown(e) {\n          _this2.mouseMoveDown(e, 'position');\n\n          _this2.props.setWindowIndex(_this2.props.window, _this2.props.openWindowList);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }), React.createElement(View, {\n        padding: \"0px\",\n        width: \"100%\",\n        style: {\n          overflow: 'scroll'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, this.props.children), React.createElement(\"div\", {\n        ref: function ref(el) {\n          return _this2.windowCover = el;\n        },\n        style: cover,\n        onClick: function onClick() {\n          return _this2.props.setWindowIndex(_this2.props.window, _this2.props.openWindowList);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      })), !isFullScreen && React.createElement(\"span\", {\n        onMouseDown: function onMouseDown(e) {\n          _this2.mouseMoveDown(e, 'wh');\n\n          _this2.props.setWindowIndex(_this2.props.window, _this2.props.openWindowList);\n        },\n        style: buttonStyle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return WindowsMac;\n}(Component);\n\nvar initMapStateToProps = function initMapStateToProps(state) {\n  return {\n    openWindowList: state.getIn(['homeMac', 'openWindowList']).toJS()\n  };\n};\n\nvar initMapDispatchToProps = function initMapDispatchToProps(dispatch) {\n  return {\n    /*\n     * 关闭窗口\n     */\n    closeWindow: function closeWindow(type, openWindowList) {\n      dispatch(actionCreatorsHomeMac.closeWindow(type, openWindowList));\n    },\n\n    /*\n     * 隐藏窗口\n     */\n    hiddenWindow: function hiddenWindow(window, windowList) {\n      dispatch(actionCreatorsHomeMac.hiddenWindow(window, windowList));\n    }\n  };\n};\n\nexport default connect(initMapStateToProps, initMapDispatchToProps)(WindowsMac);","map":{"version":3,"sources":["/Users/linjiajun/Desktop/htdoc/web/react-desktops/src/components/windows/WindowsMac.js"],"names":["React","Component","Fragment","View","Window","TitleBar","connect","actionCreators","actionCreatorsHomeMac","WindowOffsetWidth","window","innerWidth","WindowOffsetHeight","innerHeight","lastWindowStyleState","WindowsMac","props","state","isFullScreen","setZIndex","zIndex","setState","mouseMoveDown","e","type","stopPropagation","windowWidth","offsetWidth","windowHeight","offsetHeight","moveStartX","clientX","moveStartY","clientY","moving","addEventListener","mouseMove","windowCover","style","display","moveDivWeightHeight","preventDefault","moveEndX","moveEndY","width","height","handleClickSetScreen","left","top","toggleWindowShow","showWindow","mouseMovePosition","mouseEndX","mouseEndY","windowLeftEnd","windowLeft","windowTopEnd","windowTop","document","body","clientHeight","clientWidth","mouseUp","removeEventListener","newProps","newState","showWindowStyleProperty","isShow","windowStyle","position","visibility","buttonStyle","bottom","right","cursor","showCover","isTop","cover","name","closeWindow","openWindowList","hiddenWindow","setWindowIndex","overflow","children","el","initMapStateToProps","getIn","toJS","initMapDispatchToProps","dispatch","windowList"],"mappings":"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","sourcesContent":["import React, {Component, Fragment} from 'react'\nimport { View,Window,TitleBar } from 'react-desktop'\nimport { connect } from 'react-redux'\nimport { actionCreators as actionCreatorsHomeMac } from '../../pages/Home/store';\nconst WindowOffsetWidth = window.innerWidth\nconst WindowOffsetHeight = window.innerHeight\nlet lastWindowStyleState = null //记录前一次设置的屏幕属性\nclass WindowsMac extends Component {\n  constructor(props){\n    super(props)\n    this.moving = false\n    this.type=''\n    this.width = WindowOffsetWidth-105 + 'px'\n    this.height = WindowOffsetHeight-50 + 'px'\n    this.windowTop = 26\n    this.windowLeft= 80\n  }\n  state = {\n    isFullScreen:false,\n\n  }\n  componentDidMount(){\n    window.addEventListener('mouseup',this.mouseUp)\n  }\n  componentWillUnmount(){\n    window.removeEventListener('mouseup',this.mouseUp)\n  }\n  shouldComponentUpdate(newProps,newState) {\n    if(newProps.zIndex !== this.props.zIndex){\n      return true\n    }\n    if(newProps.window !== this.props.window){\n      return true\n    }\n    if(newState.isFullScreen !== this.state.isFullScreen){\n      return true\n    }\n    return false\n  }\n  render() {\n    const { isFullScreen } = this.state\n    const showWindowStyleProperty = this.props.window.isShow ? \"visible\" : \"hidden\"\n    const windowStyle = {\n      position:'absolute',\n      display:'block',\n      top:this.windowTop+\"px\",\n      left:this.windowLeft+\"px\",\n      width:this.width,\n      height:this.height,\n      zIndex:this.props.zIndex,\n      visibility: showWindowStyleProperty\n    }\n    const buttonStyle={\n      width: '50px',\n      height: '50px',\n      position: 'absolute',\n      bottom: '-15px',\n      right: '-15px',\n      cursor: 'se-resize',\n      zIndex: this.props.zIndex+9\n    }\n\n    const showCover = this.props.window.isTop ? 'none' : 'block'\n    const cover={\n      width:'100%',\n      height:'100%',\n      position:'absolute',\n      zIndex:this.props.zIndex+8,\n      display: showCover\n    }\n    return (\n      <Fragment>\n        <span\n            style={windowStyle}\n            ref={e => this.window = e}\n          >\n        <Window\n          chrome\n          width=\"100%\"\n          height=\"100%\"\n          padding=\"0px\"\n        >\n          <TitleBar\n            title={this.props.window.name}\n            controls\n            isFullscreen={isFullScreen}\n            onCloseClick={() => {\n              this.props.closeWindow(this.props.window.type,this.props.openWindowList)\n            }}\n            onMinimizeClick={()=>this.props.hiddenWindow(this.props.window,this.props.openWindowList)}\n            onResizeClick={() => {\n              this.handleClickSetScreen()\n            }}\n            onMouseDown={e => {\n              this.mouseMoveDown(e,'position')\n              this.props.setWindowIndex(this.props.window,this.props.openWindowList)\n            }}\n          />\n          <View\n            padding=\"0px\"\n            width=\"100%\"\n            style={{overflow: 'scroll'}}\n          >\n            {this.props.children}\n          </View>\n          <div\n            ref={el=>this.windowCover=el}\n            style={cover}\n            onClick={()=>this.props.setWindowIndex(this.props.window,this.props.openWindowList)}\n          />\n        </Window>\n          {!isFullScreen &&\n          <span\n            onMouseDown={e => {\n              this.mouseMoveDown(e,'wh')\n              this.props.setWindowIndex(this.props.window,this.props.openWindowList)\n            }}\n            style={buttonStyle}\n          />\n          }\n        </span>\n\n      </Fragment>\n\n    )\n  }\n  setZIndex = (zIndex) => {\n    this.setState({\n      zIndex\n    })\n  }\n  mouseMoveDown = (e,type) => {\n    if(!this.state.isFullScreen) {\n      e.stopPropagation() //防止事件冒泡\n      this.windowWidth = this.window.offsetWidth\n      this.windowHeight = this.window.offsetHeight\n      this.moveStartX = e.clientX\n      this.moveStartY = e.clientY\n      this.moving = true\n      this.type = type\n      window.addEventListener('mousemove', this.mouseMove)\n      this.windowCover.style.display = 'block'\n    }\n  }\n  moveDivWeightHeight = (e) => {\n    e.preventDefault();\n    if(this.moving){\n      const moveEndX = e.clientX\n      const moveEndY = e.clientY\n      const width = this.windowWidth + moveEndX - this.moveStartX\n      const height = this.windowHeight + moveEndY - this.moveStartY\n      if(width>460 &&  width<(WindowOffsetWidth-77)){\n        this.window.style.width = width + 'px'\n      }\n      if(height>400 && height<(WindowOffsetHeight-26)){\n        this.window.style.height = height + 'px'\n      }\n    }\n  }\n  /*\n   * 控制全屏\n   */\n  handleClickSetScreen = () => {\n    const { isFullScreen } = this.state\n    if(isFullScreen){\n      this.setState({\n        isFullScreen:false\n      },()=>{\n        this.window.style.width = lastWindowStyleState.width\n        this.window.style.height = lastWindowStyleState.height\n        this.window.style.left = lastWindowStyleState.left\n        this.window.style.top = lastWindowStyleState.top\n        this.window.style.zIndex = lastWindowStyleState.zIndex\n        lastWindowStyleState = null\n      })\n    }else{\n      lastWindowStyleState = {...this.window.style}\n      this.setState({\n        isFullScreen:true\n      },()=>{\n        this.window.style.width = WindowOffsetWidth + 'px'\n        this.window.style.height = WindowOffsetHeight + 'px'\n        this.window.style.top = '0px'\n        this.window.style.left = '0px'\n        this.window.style.zIndex = '10'\n      })\n    }\n  }\n  /*\n   * 显示和隐藏窗口\n   */\n  toggleWindowShow = () => {\n    this.setState({\n      showWindow:!this.state.showWindow\n    })\n  }\n  mouseMovePosition = (e) => {\n    e.preventDefault();\n    const mouseEndX = e.clientX\n    const mouseEndY = e.clientY\n    this.windowLeftEnd = this.windowLeft + mouseEndX - this.moveStartX;\n    this.windowTopEnd = this.windowTop + mouseEndY - this.moveStartY;\n    if(this.windowTopEnd<26){  //防止移动和工具栏重叠\n      this.windowTopEnd = 26\n    }\n    if(this.windowTopEnd>=(document.body.clientHeight - 26)){\n      this.windowTopEnd = document.body.clientHeight - 26\n    }\n    if(this.windowLeftEnd<(80 - this.windowWidth)){\n      this.windowLeftEnd = 80 - this.windowWidth\n    }\n    if(this.windowLeftEnd>=(document.body.clientWidth - 80)){\n      this.windowLeftEnd = document.body.clientWidth - 80\n    }\n    this.window.style.top=this.windowTopEnd + 'px'\n    this.window.style.left=this.windowLeftEnd + 'px'\n  }\n  mouseMove = (e) => {\n    e.preventDefault();\n    if(this.moving){\n      if(this.type === 'position'){\n        this.mouseMovePosition(e)\n      }\n      if(this.type === 'wh'){\n        this.moveDivWeightHeight(e)\n      }\n    }\n  }\n  mouseUp = () => {\n    this.moving = false\n    if(this.type === 'position'){\n      this.windowLeft = this.windowLeftEnd\n      this.windowTop = this.windowTopEnd\n      this.windowCover.style.display = 'none'\n    }\n    if(this.type === 'wh'){\n      this.moveStartX = null\n      this.moveStartY = null\n      this.windowWidth = null\n      this.windowHeight = null\n      this.windowCover.style.display = 'none'\n    }\n    this.type = ''\n    window.removeEventListener('mousemove',this.mouseMove)\n  }\n}\n\nconst initMapStateToProps = (state) => ({\n  openWindowList:state.getIn(['homeMac','openWindowList']).toJS(),\n})\nconst initMapDispatchToProps = (dispatch) => ({\n  /*\n   * 关闭窗口\n   */\n  closeWindow(type,openWindowList){\n    dispatch(actionCreatorsHomeMac.closeWindow(type,openWindowList))\n  },\n  /*\n   * 隐藏窗口\n   */\n  hiddenWindow(window,windowList){\n    dispatch(actionCreatorsHomeMac.hiddenWindow(window,windowList))\n  }\n})\n\nexport default connect(initMapStateToProps,initMapDispatchToProps)(WindowsMac)"]},"metadata":{},"sourceType":"module"}